

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hugging Face Model Type Support &mdash; cosmos-rl 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multi-node example" href="../multinodes/overview.html" />
    <link rel="prev" title="Customization" href="customization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cosmos-rl
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="single_node_example.html">Single node example</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataflow.html">Dataset &amp; Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Customization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hugging Face Model Type Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#design-of-hf-model-type">Design of HF Model Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#policy-parallelism-support">Policy Parallelism Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#special-case-mistral-sft-with-custom-dataset-loader">Special Case: Mistral SFT with Custom Dataset Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-hf-models">Supported HF Models</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multi nodes training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../multinodes/overview.html">Multi-node example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multinodes/dgxc_lepton.html">DGXC-Lepton Job</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multinodes/slurm.html">Slurm Job</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Elastic &amp; Fault Tolerance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../elastic/overview.html">Elastic Scaling and Fault Tolerance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Async RL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html#key-features">Key Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html#architecture">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html#putting-it-all-together">Putting It All Together</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parallelism</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../parallelism/overview.html">Parallelism</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quantization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quantization/fp8.html">FP8 Quantization</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cosmos-rl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Hugging Face Model Type Support</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/quickstart/hf_models_support.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="hugging-face-model-type-support">
<h1>Hugging Face Model Type Support<a class="headerlink" href="#hugging-face-model-type-support" title="Link to this heading"></a></h1>
<section id="design-of-hf-model-type">
<h2>Design of HF Model Type<a class="headerlink" href="#design-of-hf-model-type" title="Link to this heading"></a></h2>
<p>The HF Model Type (<code class="docutils literal notranslate"><span class="pre">HFLLMModel</span></code>) in cosmos-rl is designed to provide a generic and flexible interface for integrating HF models into the training and inference pipeline. The core implementation is located in <code class="docutils literal notranslate"><span class="pre">cosmos_rl/policy/model/hf_llm/__init__.py</span></code>, where the <code class="docutils literal notranslate"><span class="pre">HFLLMModel</span></code> class acts as a universal wrapper for any model supported by Hugging Face’s <code class="docutils literal notranslate"><span class="pre">AutoModelForCausalLM</span></code>.
Key design points:</p>
<ul class="simple">
<li><p><strong>Generic Wrapper:</strong> <code class="docutils literal notranslate"><span class="pre">HFLLMModel</span></code> can load any model architecture supported by Hugging Face, as long as it is compatible with <code class="docutils literal notranslate"><span class="pre">AutoModelForCausalLM</span></code>.</p></li>
<li><p><strong>Automatic Fallback:</strong> If a model is not custom-defined in the <code class="docutils literal notranslate"><span class="pre">cosmos_rl/policy/model</span></code> directory, the system will automatically use the HF Models Type, ensuring broad compatibility and reducing the need for custom code.</p></li>
<li><p><strong>Config and Weight Loading:</strong> The model configuration is loaded using <code class="docutils literal notranslate"><span class="pre">AutoConfig.from_pretrained</span></code>, and model weights are loaded via <code class="docutils literal notranslate"><span class="pre">AutoModelForCausalLM.from_pretrained</span></code>. This allows seamless integration with models from the Hugging Face Hub or local checkpoints.</p></li>
<li><p><strong>Distributed Training Support:</strong> The wrapper is designed to work with distributed training strategies such as FSDP, and includes logic for weight synchronization, rotary embedding handling, and compatibility checks for parallelism.</p></li>
<li><p><strong>Extensibility:</strong> By using the HF Models Type, users can quickly experiment with new or custom Hugging Face models without waiting for explicit support in cosmos-rl.</p></li>
</ul>
<p>This design ensures that cosmos-rl remains extensible and up-to-date with the rapidly evolving Hugging Face ecosystem, while still allowing for custom optimizations and model-specific logic when needed.</p>
</section>
<section id="policy-parallelism-support">
<h2>Policy Parallelism Support<a class="headerlink" href="#policy-parallelism-support" title="Link to this heading"></a></h2>
<p>Currently, the Policy module only supports Fully Sharded Data Parallel (FSDP) for distributed training and inference.</p>
</section>
<section id="special-case-mistral-sft-with-custom-dataset-loader">
<h2>Special Case: Mistral SFT with Custom Dataset Loader<a class="headerlink" href="#special-case-mistral-sft-with-custom-dataset-loader" title="Link to this heading"></a></h2>
<p>For certain models like Mistral, SFT requires a custom dataset loader to avoid role alternation errors. Use the provided <cite>raw_text_sft.py</cite> script for this purpose.</p>
<p>Example command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cosmos-rl<span class="w"> </span>--config<span class="w"> </span>configs/mistral/mistral-7b-fsdp4-sft.toml<span class="w"> </span>cosmos_rl.tools.dataset.dummy_sft.py
</pre></div>
</div>
<p>Another example for different configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cosmos-rl<span class="w"> </span>--config<span class="w"> </span>configs/mistral/mistral-7b-p-fsdp1-r-tp1-grpo.toml
</pre></div>
</div>
</section>
<section id="supported-hf-models">
<h2>Supported HF Models<a class="headerlink" href="#supported-hf-models" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Mistral</p></li>
<li><p>Gemma</p></li>
<li><p>Phi</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mistral, Gemma, Phi have been tested. Other HF models may also be supported. If you encounter any issues when training other models, please feel free to open an issue and let us know.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="customization.html" class="btn btn-neutral float-left" title="Customization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../multinodes/overview.html" class="btn btn-neutral float-right" title="Multi-node example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>