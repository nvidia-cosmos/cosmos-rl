

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-node example &mdash; cosmos-rl 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DGXC-Lepton Job" href="dgxc_lepton.html" />
    <link rel="prev" title="Hugging Face Model Type Support" href="../quickstart/hf_models_support.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cosmos-rl
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/single_node_example.html">Single node example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/dataflow.html">Dataset &amp; Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/customization.html">Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/hf_models_support.html">Hugging Face Model Type Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multi nodes training</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multi-node example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#manual-deployment">Manual deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dgxc-lepton-job-example">DGXC-Lepton job example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slurm-job-example">Slurm job example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dgxc_lepton.html">DGXC-Lepton Job</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurm.html">Slurm Job</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Elastic &amp; Fault Tolerance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../elastic/overview.html">Elastic Scaling and Fault Tolerance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Async RL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html#key-features">Key Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html#architecture">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async/overview.html#putting-it-all-together">Putting It All Together</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parallelism</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../parallelism/overview.html">Parallelism</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quantization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quantization/fp8.html">FP8 Quantization</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cosmos-rl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Multi-node example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/multinodes/overview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="multi-node-example">
<h1>Multi-node example<a class="headerlink" href="#multi-node-example" title="Link to this heading"></a></h1>
<section id="manual-deployment">
<h2>Manual deployment<a class="headerlink" href="#manual-deployment" title="Link to this heading"></a></h2>
<p>Similar to single-node example, a controller process should be launched first and any extra <em>policy</em> and <em>rollout</em> replica can join at any time.</p>
<p>In this example, 4 policy replica with each of 4 GPUs and two rollout replica with each of 2 GPUs are launched.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">### On node A</span>
<span class="c1"># 1. Launch the controller process</span>
./cosmos_rl/launcher/launch_controller.sh<span class="w"> </span>--port<span class="w"> </span><span class="m">8000</span><span class="w"> </span>--config<span class="w"> </span>configs/qwen3/qwen3-8b-p-tp4-r-tp2-pp1-grpo.toml

<span class="nb">export</span><span class="w"> </span><span class="nv">COSMOS_CONTROLLER_HOST</span><span class="o">=</span>localhost:8000

<span class="c1"># 2. Launch one policy replica of 4 GPUs</span>
<span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>,1,2,3<span class="w"> </span>./tools/launch_replica.sh<span class="w"> </span>--type<span class="w"> </span>policy<span class="w"> </span>--ngpus<span class="w"> </span><span class="m">4</span>

<span class="c1"># 3. Launch two rollout replicas of 2 GPUs</span>
<span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">4</span>,5<span class="w"> </span>./tools/launch_replica.sh<span class="w"> </span>--type<span class="w"> </span>rollout<span class="w"> </span>--ngpus<span class="w"> </span><span class="m">2</span>
<span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">6</span>,7<span class="w"> </span>./tools/launch_replica.sh<span class="w"> </span>--type<span class="w"> </span>rollout<span class="w"> </span>--ngpus<span class="w"> </span><span class="m">2</span>

<span class="c1">### On node B</span>
<span class="c1"># Launch two more policy replicas of 4 GPUs</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COSMOS_CONTROLLER_HOST</span><span class="o">={</span>node-A-host-or-ip<span class="o">}</span>:8000
<span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>,1,2,3<span class="w"> </span>./tools/launch_replica.sh<span class="w"> </span>--type<span class="w"> </span>policy<span class="w"> </span>--ngpus<span class="w"> </span><span class="m">4</span>
<span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">4</span>,5,6,7<span class="w"> </span>./tools/launch_replica.sh<span class="w"> </span>--type<span class="w"> </span>policy<span class="w"> </span>--ngpus<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="line-block">
<div class="line">In case one single replica needs more GPUs than 8 (across multiple nodes),</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--rdzv-endpoint<span class="o">={</span>MASTER_ADDR<span class="o">}</span>:<span class="o">{</span>MASTER_PORT<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">should be specified for <cite>launch_replica.sh</cite> to correctly form a valid replica.</div>
</div>
</div>
</section>
<section id="dgxc-lepton-job-example">
<h2>DGXC-Lepton job example<a class="headerlink" href="#dgxc-lepton-job-example" title="Link to this heading"></a></h2>
<p>DGXC-Lepton Job takes care of the number of GPU required by each policy and rollout replica. It will calculate and allocate the number of total nodes necessary to launch the job.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cosmos</span><span class="o">-</span><span class="n">rl</span> \
<span class="go">        --config ./configs/qwen3/qwen3-8b-p-tp4-r-tp2-pp1-grpo.toml \</span>
<span class="go">        --lepton-mode \</span>
<span class="go">        --lepton-job-name cosmos-multi-node-test \</span>
<span class="go">        --lepton-container-image {your-docker-image} \</span>
<span class="go">        --lepton-resource-shape gpu.8xh100-sxm \</span>
<span class="go">        --lepton-node-group {your-node-group} \</span>
<span class="go">        --lepton-secret HUGGING_FACE_HUB_TOKEN={your-hugging-face-token} \</span>
<span class="go">        --policy 8 \</span>
<span class="go">        --rollout 4 \</span>
<span class="go">        /workspace/cosmos_rl/tools/dataset/math_dapo.py</span>
</pre></div>
</div>
<p>Total <cite>8*4 + 4*2 = 40</cite> GPUs are used. (5 <cite>8xH100</cite> nodes will be allocated for this job)</p>
<p>For more details about DGXC-Lepton, please refer to <a class="reference internal" href="dgxc_lepton.html"><span class="doc">DGXC-Lepton Job</span></a></p>
</section>
<section id="slurm-job-example">
<h2>Slurm job example<a class="headerlink" href="#slurm-job-example" title="Link to this heading"></a></h2>
<p>Cosmos slurm Job takes care of the number of GPU required by each policy and rollout replica. It will calculate and allocate the number of total nodes necessary to launch the job, then allocate and launch the job on the slurm cluster.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">slurm</span><span class="o">/</span><span class="n">dispatch_job</span><span class="o">.</span><span class="n">py</span> \
<span class="go">        --ngpu-per-node 8 \</span>
<span class="go">        --n-policy-replicas 8 \</span>
<span class="go">        --n-rollout-replicas 4  \</span>
<span class="go">        --config-path configs/qwen2-5/qwen2-5-32b-p-fsdp2-tp4-r-tp4-pp1-grpo-gsm8k.toml \</span>
<span class="go">        --repo-root-path ${YOUR_COSMOS_REPO_PATH} \</span>
<span class="go">        --output-root-path ${YOUR_COSMOS_LOG_OUTPUT_PATH} \</span>
<span class="go">        --cosmos-container ${YOUR_COSMOS_SQSQ_PATH} \</span>
<span class="go">        --slurm-partition ${YOUR_SLURM_PARTITION} \</span>
<span class="go">        --slurm-account ${YOUR_SLURM_ACCOUNT} \</span>
<span class="go">        tools/dataset/gsm8k_grpo.py</span>
</pre></div>
</div>
<p>Total <cite>8*8 + 4*4 = 64</cite> GPUs are used. (8 <cite>8xH100</cite> nodes will be allocated for this job)</p>
<p>For more details about Slurm job submission, please refer to <a class="reference internal" href="slurm.html"><span class="doc">Slurm Job</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../quickstart/hf_models_support.html" class="btn btn-neutral float-left" title="Hugging Face Model Type Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dgxc_lepton.html" class="btn btn-neutral float-right" title="DGXC-Lepton Job" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>